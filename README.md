# Audio Course Platform

A secure audio learning platform with access code authentication and strong protection against sharing, downloading, and recording.

## ğŸ“ Project Structure

```
audio-course/
â”œâ”€â”€ admin/                      # Admin panel
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ admin.css      # Admin styles
â”‚   â”‚   â””â”€â”€ js/
â”‚   â”‚       â””â”€â”€ admin.js       # Admin scripts
â”‚   â”œâ”€â”€ includes/
â”‚   â”‚   â”œâ”€â”€ admin_auth.php     # Admin authentication check
â”‚   â”‚   â”œâ”€â”€ header.php         # Admin header
â”‚   â”‚   â”œâ”€â”€ sidebar.php        # Admin sidebar
â”‚   â”‚   â””â”€â”€ footer.php         # Admin footer
â”‚   â”œâ”€â”€ index.php              # Dashboard
â”‚   â”œâ”€â”€ login.php              # Admin login
â”‚   â”œâ”€â”€ logout.php             # Admin logout
â”‚   â”œâ”€â”€ courses.php            # Course management
â”‚   â”œâ”€â”€ course-form.php        # Add/Edit course
â”‚   â”œâ”€â”€ lessons.php            # Lesson management
â”‚   â”œâ”€â”€ lesson-form.php        # Add/Edit lesson with audio upload
â”‚   â”œâ”€â”€ access-codes.php       # Access code management
â”‚   â”œâ”€â”€ users.php              # User management
â”‚   â””â”€â”€ activity-logs.php      # Activity logs
â”‚
â”œâ”€â”€ api/                        # API endpoints
â”‚   â”œâ”€â”€ get-audio-token.php    # Generate audio streaming token
â”‚   â””â”€â”€ save-progress.php      # Save user progress
â”‚
â”œâ”€â”€ assets/                     # Public assets
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css          # Main styles
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js             # Main application JS
â”‚       â””â”€â”€ security.js        # Security measures
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ config.php             # Database configuration
â”‚   â””â”€â”€ schema.sql             # Database schema
â”‚
â”œâ”€â”€ includes/                   # Core PHP classes
â”‚   â”œâ”€â”€ init.php               # Bootstrap file
â”‚   â”œâ”€â”€ Security.php           # Security utilities
â”‚   â”œâ”€â”€ Session.php            # Session management
â”‚   â”œâ”€â”€ Auth.php               # Authentication
â”‚   â”œâ”€â”€ AccessCode.php         # Access code management
â”‚   â”œâ”€â”€ AudioStream.php        # Audio streaming handler
â”‚   â”œâ”€â”€ auth_check.php         # User authentication middleware
â”‚   â”œâ”€â”€ header.php             # User header
â”‚   â””â”€â”€ footer.php             # User footer
â”‚
â”œâ”€â”€ uploads/                    # Uploaded files (protected)
â”‚   â”œâ”€â”€ audio/                 # Audio files
â”‚   â”‚   â””â”€â”€ .htaccess          # Deny direct access
â”‚   â””â”€â”€ thumbnails/            # Course thumbnails
â”‚
â”œâ”€â”€ index.php                   # Login page
â”œâ”€â”€ courses.php                 # Courses listing
â”œâ”€â”€ lessons.php                 # Lessons with audio player
â”œâ”€â”€ stream.php                  # Audio streaming endpoint
â”œâ”€â”€ logout.php                  # User logout
â”œâ”€â”€ .htaccess                   # Security rules
â””â”€â”€ README.md                   # This file
```

## âš™ï¸ Installation

### Requirements
- PHP 7.4+ (8.0+ recommended)
- MySQL 5.7+ or MariaDB 10.3+
- Apache with mod_rewrite enabled
- XAMPP, WAMP, or similar local server

### Setup Steps

1. **Copy Project Files**
   ```
   Copy the 'audio-course' folder to your web server directory
   (e.g., C:\xampp\htdocs\audio-course)
   ```

2. **Create Database**
   - Open phpMyAdmin (http://localhost/phpmyadmin)
   - Create a new database named `audio_course_db`
   - Or run: `CREATE DATABASE audio_course_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`

3. **Import Database Schema**
   - Select the `audio_course_db` database
   - Go to Import tab
   - Choose file: `database/schema.sql`
   - Click "Go" to import

4. **Configure Database Connection**
   - Open `database/config.php`
   - Update database credentials if needed:
   ```php
   define('DB_HOST', 'localhost');
   define('DB_NAME', 'audio_course_db');
   define('DB_USER', 'root');
   define('DB_PASS', '');
   ```

5. **Set Security Key**
   - In `database/config.php`, change the SECURE_KEY:
   ```php
   define('SECURE_KEY', 'your-unique-random-key-here');
   ```

6. **Set Folder Permissions**
   - Ensure `uploads/audio` is writable by PHP
   - On Linux: `chmod 755 uploads/audio`

7. **Access the Platform**
   - User Login: http://localhost/audio-course/
   - Admin Panel: http://localhost/audio-course/admin/

### Default Admin Credentials
- **Username:** admin
- **Password:** admin123
- âš ï¸ **Change this immediately after first login!**

## ğŸ” Authentication & Access Control

### Access Code System
- Users cannot self-register
- Access is controlled via one-time access codes
- Codes are generated by admins with configurable expiration
- Each code can only be used by one user
- When a code is revoked, the associated user is immediately logged out

### Single Session Enforcement
- Only one active session per user is allowed
- If a user logs in from a new device/browser:
  - Previous session is automatically invalidated
  - Previous device will require re-login
- Sessions expire after inactivity (default: 1 hour)
- Closing browser ends the session

### Session Security
- Secure session cookies (HttpOnly, SameSite)
- Session tokens stored in database
- IP address and device fingerprint tracking
- Session regeneration to prevent fixation attacks

## ğŸ§ Audio Security Features

### Download Prevention
- âŒ No direct file access (protected by .htaccess)
- âŒ Right-click disabled
- âŒ Keyboard shortcuts for save/download blocked
- âŒ Audio controlsList set to 'nodownload'

### Streaming Security
- âœ… Token-based audio URLs
- âœ… Short-lived tokens (5 minutes default)
- âœ… Tokens bound to user, session, and IP
- âœ… Single-use tokens
- âœ… Server-side streaming (no direct file exposure)

### Recording Prevention (Best Effort)
- âŒ DevTools detection with audio pause
- âŒ MediaRecorder API blocked
- âŒ Web Audio createMediaStreamDestination blocked
- âŒ Print/screenshot protection (limited)
- âŒ Tab visibility detection (pause when hidden)
- âš ï¸ Dynamic watermarks with user info (forensic tracking)

### Inspection Prevention
- âŒ F12 key blocked
- âŒ Ctrl+Shift+I/J/C blocked
- âŒ Ctrl+U (view source) blocked
- âŒ Console cleared periodically
- âŒ Debugger detection

## ğŸ—ƒï¸ Database Tables

| Table | Description |
|-------|-------------|
| `admins` | Admin user accounts |
| `users` | User accounts (created via access codes) |
| `user_sessions` | Active user sessions |
| `access_codes` | Generated access codes |
| `courses` | Course information |
| `lessons` | Lesson information |
| `audio_files` | Audio file metadata |
| `audio_tokens` | Short-lived streaming tokens |
| `user_progress` | User listening progress |
| `activity_logs` | Security and activity logs |
| `settings` | Application settings |

## ğŸ› ï¸ Admin Features

### Courses Management
- Create, edit, delete courses
- Set course status (active/inactive/draft)
- Custom sort order

### Lessons Management
- Create, edit, delete lessons
- Upload audio files (MP3, WAV, OGG, M4A)
- Automatic duration detection
- Associate with courses

### Access Codes
- Generate single or batch codes
- Configurable expiration (1 day to 1 year)
- View code usage status
- Revoke codes (immediately logs out user)
- Track which user used which code

### User Management
- View all users
- See online status
- Block/unblock users
- Force logout users

### Activity Logs
- Track all login attempts
- Track admin actions
- Track audio access
- IP address logging

## ğŸ”’ Security Best Practices

1. **Change default admin password** immediately
2. **Use HTTPS** in production (uncomment in .htaccess)
3. **Change SECURE_KEY** in config.php
4. **Keep PHP and MySQL updated**
5. **Regular backups** of database and audio files
6. **Monitor activity logs** for suspicious behavior
7. **Set strong access code expiration times**

## âš ï¸ Security Limitations

While this platform implements many security measures, complete protection against determined attackers is not possible:

- **Screen recording** can only be detected, not fully prevented
- **Audio capture** via external devices cannot be blocked
- **Analog hole** (recording from speakers) is always possible
- **Browser extensions** may bypass JavaScript protections

The security measures are designed to:
- Prevent casual copying/sharing
- Make it difficult to mass-distribute content
- Provide forensic tracking via watermarks
- Detect and respond to suspicious behavior

## ï¿½ Deployment

### GitHub Actions Deployment to Hostinger

This project is configured for automatic deployment to Hostinger using GitHub Actions.

#### Prerequisites
1. GitHub repository with the code
2. Hostinger FTP access credentials
3. GitHub repository secrets configured

#### Setup Steps

1. **Configure GitHub Secrets**
   - Go to your GitHub repository â†’ Settings â†’ Secrets and variables â†’ Actions
   - Add secret: `FTP_PASSWORD` (your Hostinger FTP password)

2. **Verify Deployment Configuration**
   - Check `.github/workflows/deploy.yml` for correct settings
   - Subdomain: `private.bryarahmad.com` â†’ `/public_html/private/`

3. **Deploy**
   ```bash
   git add .
   git commit -m "Deploy to production"
   git push origin main
   ```
   - Deployment will start automatically
   - Monitor progress in GitHub Actions tab

#### Post-Deployment Steps

After first deployment, you must fix audio file paths:

1. **Access the migration script**
   ```
   https://private.bryarahmad.com/migrate_fix_audio_paths.php?authorize
   ```

2. **Review the current status** showing how many paths need fixing

3. **Click "Run Migration Now"** to convert absolute paths to relative paths

4. **Delete the migration file** after successful migration for security

#### Database Configuration

Make sure your `database/config.php` has correct production credentials:

```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'u314367906_private');
define('DB_USER', 'u314367906_private');
define('DB_PASS', 'your_password');
```

#### Troubleshooting

**Audio playback error (Ø®Û•Ù„Û•ØªÛŒ Ø¯ Ù„ÛØ¯Ø§Ù†Ø§ Ø¯Û•Ù†Ú¯ÛŒ Ø¯Ø§):**
- Cause: Audio file paths stored as absolute Windows paths
- Solution: Run the migration script `migrate_fix_audio_paths.php`

**Files not uploading:**
- Check `uploads/audio/` directory exists and has write permissions (755)
- Verify PHP upload limits in hosting control panel

**Database connection errors:**
- Verify database credentials in `database/config.php`
- Check if database exists in cPanel

## ï¿½ğŸ“ License

This project is for educational purposes. Implement additional security measures as needed for production use.

## ğŸ¤ Support

For issues or feature requests, please create an issue in the repository or contact the administrator.
